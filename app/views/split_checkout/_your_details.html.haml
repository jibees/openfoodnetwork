%div.checkout-substep
  -# YOUR DETAILS
  %div.checkout-title
    = t("split_checkout.step1.your_details.title")

  %div.checkout-input
    = validated_input t("split_checkout.step1.your_details.first_name.label"), "order.bill_address.firstname", {placeholder: t("split_checkout.step1.your_details.first_name.placeholder")}

  %div.checkout-input
    = validated_input t("split_checkout.step1.your_details.last_name.label"), "order.bill_address.lastname", {placeholder: t("split_checkout.step1.your_details.last_name.placeholder")}

  %div.checkout-input
    = validated_input t("split_checkout.step1.your_details.email.label"), "order.email", {placeholder: t("split_checkout.step1.your_details.email.placeholder")}
  
  %div.checkout-input
    = validated_input t("split_checkout.step1.your_details.phone.label"), "order.bill_address.phone", {placeholder: t("split_checkout.step1.your_details.phone.placeholder")}

%div.checkout-substep
  -# BILLING ADDRESS
  %div.checkout-title
    = t("split_checkout.step1.billing_address.title")

  %div.checkout-input
    = validated_input t("split_checkout.step1.billing_address.address1.label"), "order.bill_address.address1", {placeholder: t("split_checkout.step1.billing_address.address1.placeholder")}

  %div.checkout-input
    = validated_input t("split_checkout.step1.billing_address.address2.label"), "order.bill_address.address2", {placeholder: t("split_checkout.step1.billing_address.address2.placeholder"), required: false}

  %div.checkout-input
    = validated_input t("split_checkout.step1.billing_address.city.label"), "order.bill_address.city", {placeholder: t("split_checkout.step1.billing_address.city.placeholder")}

  %div.checkout-input
    = validated_select t("split_checkout.step1.billing_address.state_id.label"), "order.bill_address.state_id", {}, {"ng-options" => "s.id as s.name for s in countriesById[order.bill_address.country_id].states"}

  %div.checkout-input
    = validated_input t("split_checkout.step1.billing_address.zipcode.label"), "order.bill_address.zipcode", {placeholder: t("split_checkout.step1.billing_address.zipcode.placeholder")}

  %div.checkout-input
    = validated_select t("split_checkout.step1.billing_address.country.label"), "order.bill_address.country_id", {}, {"ng-init" => "order.bill_address.country_id = order.bill_address.country_id || #{DefaultCountry.id}", "ng-options" => "c.id as c.name for c in countries"}
  
  - if spree_current_user
    %div.checkout-input
      %input{type: :checkbox, id: "Checkout.default_bill_address", "ng-model": "Checkout.default_bill_address"}
      %label{for: "Checkout.default_bill_address" }
        = t :checkout_default_bill_address

  %div.checkout-substep  
    -# DELIVERY ADDRESS
    %div.checkout-title
      = t("split_checkout.step1.delivery_address.title")

    %div.checkout-input{"ng-repeat": "method in ShippingMethods.shipping_methods | orderBy: 'name'"}
      %input{type: :radio,
        required: true,
        name: "order.shipping_method_id",
        id: "order.shipping_method_id_{{ method.id }}",
        "ng-value": "method.id",
        "ng-model": "order.shipping_method_id",
        "ng-class": "{error: !fieldValid('order.shipping_method_id')}" }
      %label{for: "order.shipping_method_id_{{ method.id }}", "ng-class": "{error: !fieldValid('order.shipping_method_id')}"}
        {{ method.name }}
        %em.light{"ng-show": "!method.price || method.price == 0"}
          = "(#{t(:checkout_method_free)})"
        %em.light{"ng-hide": "!method.price || method.price == 0"}
          ({{ method.price | localizeCurrency }})
      %small.error.medium.input-text{"ng-show": "!fieldValid('order.shipping_method_id')"}
        = "{{ fieldErrors('order.shipping_method_id') }}"


    %div.checkout-input{"ng-if" => "Checkout.requireShipAddress()"}
      %input{type: :checkbox,
        id: "Checkout.ship_address_same_as_billing",
        "ng-model": "Checkout.ship_address_same_as_billing"}
      %label{for: "Checkout.ship_address_same_as_billing" }
        = t :checkout_address_same
      
    - if spree_current_user
      %div.checkout-input{"ng-if" => "Checkout.requireShipAddress()"}
        %input{type: :checkbox, id: "Checkout.default_ship_address", "ng-model": "Checkout.default_ship_address"}
        %label{for: "Checkout.default_ship_address" }
          = t :checkout_default_ship_address
  
    .div.checkout-input{"ng-show" => "Checkout.shippingMethod().description"}
      #distributor_address.panel
        %span{}{{ Checkout.shippingMethod().description }}
        %br/
        %br/
        - if @order.order_cycle.pickup_time_for(@order.distributor)
          = t :checkout_ready_for
        = @order.order_cycle.pickup_time_for(@order.distributor)

    .div.checkout-input
      %label{ for: 'order_special_instructions'}= t(:checkout_instructions)
      = f.text_area :special_instructions, size: "60x4", "ng-model" => "order.special_instructions"

  %div.checkout-submit
    %button.button.primary{ type: :submit, ng: { disabled: "terms_and_conditions_accepted == false || platform_tos_accepted == false" } }
      = t("split_checkout.step1.submit")
    %a.button.cancel{href: main_app.cart_path}
      = t("split_checkout.step1.cancel")
